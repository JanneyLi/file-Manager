<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>文件上传</title>
    <link rel="stylesheet" href="/element-ui/lib/theme-chalk/index.css">
    <script src="/vue/dist/vue.js"></script>
    <script src="/axios/dist/axios.js"></script>
    <script src="/element-ui/lib/index.js"></script>
</head>
<body>


<el-container id="app">
    <el-header style="text-align: center">当前文件上传路径：{{inputPath}}</el-header>
    <el-main>
        <el-upload
                class="upload-demo"
                action="/upload"
                :on-preview="handlePreview"
                :on-remove="handleRemove"
                :before-remove="beforeRemove"
                multiple
                :file-list="fileList"
                :on-success="onSuccess"
        >
            <el-button size="small" type="primary">点击上传</el-button>

        </el-upload>
    </el-main>

</el-container>



<script>
    const app = new Vue({
        el: "#app",

        data: {
            inputPath: "",
            parentPath:"",
            fileList: []
        },
        created() {

            this.getFileList();
        },
        methods: {

            //获取文件列表
            getFileList(){
                axios.get(`/file`).then(
                    response => {
                        //获取上传路径
                        this.inputPath = response.data.data.inputPath;
                        //获取父路径
                        this.parentPath = response.data.data.parentPath;
                    }
                ).catch();
            },

            handleRemove(file, fileList) {

                var vue = this;

                console.log(this.parentPath);

                axios.delete(`/file?parentPath=${vue.parentPath}&childPath=${file.name}`).then(
                    response=>{
                        if(response.data.code == 20000){
                            this.$message({
                                showClose: true,
                                message: `删除${file.name}成功`,
                                type: 'success'
                            });
                        }


                    }
                ).catch();
            },
            handlePreview(file) {
                console.log(file);
            },

            beforeRemove(file, fileList) {
                return this.$confirm(`确定移除 ${file.name}？`);
            },
            onSuccess(response, file, fileList) {
                this.$message({
                    showClose: true,
                    message: `上传${file.name}成功`,
                    type: 'success'
                });

            }
        }

    });

</script>

</body>
</html>